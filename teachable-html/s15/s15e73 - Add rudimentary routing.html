<h1 id="rudimentary-routing">Rudimentary routing</h1>
<p>Imagine this. A user finds your dataviz, clicks around, and finds an interesting insight. They share it with their friends.</p>
<p><em>“See! I was right! This link proves it.”</em></p>
<p><em>“Wtf are you talking about?”</em></p>
<p><em>“Oh… uuuuh… you have to click this and then that and then you’ll see. I’m legit winning our argument.”</em></p>
<p><em>“Wow! Kim Kardashian just posted a new snap with her dog.”</em></p>
<p>Let’s help our intrepid user out and make our dataviz linkable. We should store the current <code>filteredBy</code> state in the URL and be able to restore from a link.</p>
<p>There are many ways to achieve this. <a href="https://github.com/ReactTraining/react-router">ReactRouter</a> comes to mind, but the quickest is to implement our own rudimentary routing. We’ll add some logic to manipulate and read the URL hash.</p>
<p>The easiest place to put this logic is next to the existing filter logic inside the <code>Controls</code> component. Better places exist from a “low-down components shouldn’t play with global state” perspective, but that’s okay.</p>
<div class="sourceCode" id="cb115" data-caption="Add rudimentary routing"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb115-1" title="1"><span class="co">// src/components/Controls/index.js</span></a>
<a class="sourceLine" id="cb115-2" title="2"></a>
<a class="sourceLine" id="cb115-3" title="3"><span class="kw">class</span> Controls <span class="kw">extends</span> <span class="va">React</span>.<span class="at">Component</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb115-4" title="4">    <span class="co">// ..</span></a>
<a class="sourceLine" id="cb115-5" title="5"></a>
<a class="sourceLine" id="cb115-6" title="6">    <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb115-7" title="7">        <span class="kw">let</span> [year<span class="op">,</span> USstate<span class="op">,</span> jobTitle] <span class="op">=</span> <span class="va">window</span>.<span class="va">location</span>.<span class="at">hash</span></a>
<a class="sourceLine" id="cb115-8" title="8">            .<span class="at">replace</span>(<span class="st">&quot;#&quot;</span><span class="op">,</span> <span class="st">&quot;&quot;</span>)</a>
<a class="sourceLine" id="cb115-9" title="9">            .<span class="at">split</span>(<span class="st">&quot;-&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb115-10" title="10"></a>
<a class="sourceLine" id="cb115-11" title="11">        <span class="cf">if</span> (year <span class="op">!==</span> <span class="st">&quot;*&quot;</span> <span class="op">&amp;&amp;</span> year) <span class="op">{</span></a>
<a class="sourceLine" id="cb115-12" title="12">            <span class="kw">this</span>.<span class="at">updateYearFilter</span>(<span class="at">Number</span>(year))<span class="op">;</span></a>
<a class="sourceLine" id="cb115-13" title="13">        <span class="op">}</span></a>
<a class="sourceLine" id="cb115-14" title="14">        <span class="cf">if</span> (USstate <span class="op">!==</span> <span class="st">&quot;*&quot;</span> <span class="op">&amp;&amp;</span> USstate) <span class="op">{</span></a>
<a class="sourceLine" id="cb115-15" title="15">            <span class="kw">this</span>.<span class="at">updateUSstateFilter</span>(USstate)<span class="op">;</span></a>
<a class="sourceLine" id="cb115-16" title="16">        <span class="op">}</span></a>
<a class="sourceLine" id="cb115-17" title="17">        <span class="cf">if</span> (jobTitle <span class="op">!==</span> <span class="st">&quot;*&quot;</span> <span class="op">&amp;&amp;</span> jobTitle) <span class="op">{</span></a>
<a class="sourceLine" id="cb115-18" title="18">            <span class="kw">this</span>.<span class="at">updateJobTitleFilter</span>(jobTitle)<span class="op">;</span></a>
<a class="sourceLine" id="cb115-19" title="19">        <span class="op">}</span></a>
<a class="sourceLine" id="cb115-20" title="20">    <span class="op">}</span></a>
<a class="sourceLine" id="cb115-21" title="21">    </a>
<a class="sourceLine" id="cb115-22" title="22">    <span class="co">// ..</span></a>
<a class="sourceLine" id="cb115-23" title="23">    <span class="at">reportUpdateUpTheChain</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb115-24" title="24">        <span class="va">window</span>.<span class="va">location</span>.<span class="at">hash</span> <span class="op">=</span> [</a>
<a class="sourceLine" id="cb115-25" title="25">            <span class="kw">this</span>.<span class="va">state</span>.<span class="at">year</span> <span class="op">||</span> <span class="st">&quot;*&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb115-26" title="26">            <span class="kw">this</span>.<span class="va">state</span>.<span class="at">USstate</span> <span class="op">||</span> <span class="st">&quot;*&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb115-27" title="27">            <span class="kw">this</span>.<span class="va">state</span>.<span class="at">jobTitle</span> <span class="op">||</span> <span class="st">&quot;*&quot;</span></a>
<a class="sourceLine" id="cb115-28" title="28">        ].<span class="at">join</span>(<span class="st">&quot;-&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb115-29" title="29"></a>
<a class="sourceLine" id="cb115-30" title="30">        <span class="co">// ..</span></a>
<a class="sourceLine" id="cb115-31" title="31">    <span class="op">}</span></a></code></pre></div>
<p>We use the <code>componentDidMount</code> lifecycle hook to read the URL when <code>Controls</code> first render on our page. Presumably when the page loads, but it could be later. It doesn’t really matter <em>when</em>, just that we update our filter the first chance we get.</p>
<p><code>window.location.hash</code> gives us the hash part of the URL. We clean it up and split it into three parts: <code>year</code>, <code>USstate</code>, and <code>jobTitle</code>. If the URL is <code>localhost:3000/#2013-CA-manager</code>, then <code>year</code> becomes <code>2013</code>, <code>USstate</code> becomes <code>CA</code>, and <code>jobTitle</code> becomes <code>manager</code>.</p>
<p>We make sure each value is valid and use our existing filter update callbacks to update the visualization. Just as if it was the user clicking a button.</p>
<p>In <code>reportUpdateUpTheChain</code>, we make sure to update the URL hash. Assigning a new value to <code>window.location.hash</code> takes care of that.</p>
<p>You should see the URL changing as you click around.</p>
<figure>
<img src="https://raw.githubusercontent.com/Swizec/react-d3js-es6-ebook/2018-version/manuscript/resources/images/es6v2/changing-url.png" alt="Changing URL hash" /><figcaption>Changing URL hash</figcaption>
</figure>
<p>There’s a bug with some combinations in 2013 that don’t have enough data. It will go away when we use the full dataset.</p>
<p>If it doesn’t work at all, consult the <a href="https://github.com/Swizec/react-d3js-step-by-step/commit/2e8fb070cbee5f1e942be8ea42fa87c6c0379a9b">diff on Github</a>.</p>