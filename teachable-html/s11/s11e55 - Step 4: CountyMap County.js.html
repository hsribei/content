<h2 id="step-4-countymapcounty.js">Step 4: CountyMap/County.js</h2>
<p>The <code>County</code> component is built from two parts: imports and color constants, and a component that returns a <code>&lt;path&gt;</code>. All the hard calculation happens in <code>CountyMap</code>.</p>
<div class="sourceCode" id="cb72" data-caption="Imports and color constants"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb72-1" title="1"><span class="co">// src/components/CountyMap/County.js</span></a>
<a class="sourceLine" id="cb72-2" title="2"><span class="im">import</span> React<span class="op">,</span> <span class="op">{</span> Component <span class="op">}</span> <span class="im">from</span> <span class="st">&#39;react&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb72-3" title="3"><span class="im">import</span> _ <span class="im">from</span> <span class="st">&#39;lodash&#39;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb72-4" title="4"></a>
<a class="sourceLine" id="cb72-5" title="5"><span class="kw">const</span> ChoroplethColors <span class="op">=</span> <span class="va">_</span>.<span class="at">reverse</span>([</a>
<a class="sourceLine" id="cb72-6" title="6">    <span class="st">&#39;rgb(247,251,255)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-7" title="7">    <span class="st">&#39;rgb(222,235,247)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-8" title="8">    <span class="st">&#39;rgb(198,219,239)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-9" title="9">    <span class="st">&#39;rgb(158,202,225)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-10" title="10">    <span class="st">&#39;rgb(107,174,214)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-11" title="11">    <span class="st">&#39;rgb(66,146,198)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-12" title="12">    <span class="st">&#39;rgb(33,113,181)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-13" title="13">    <span class="st">&#39;rgb(8,81,156)&#39;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb72-14" title="14">    <span class="st">&#39;rgb(8,48,107)&#39;</span></a>
<a class="sourceLine" id="cb72-15" title="15">])<span class="op">;</span></a>
<a class="sourceLine" id="cb72-16" title="16"></a>
<a class="sourceLine" id="cb72-17" title="17"><span class="kw">const</span> BlankColor <span class="op">=</span> <span class="st">&#39;rgb(240,240,240)&#39;</span></a></code></pre></div>
<p>We import React and Lodash, and define some color constants. I got the <code>ChoroplethColors</code> from some example online, and <code>BlankColor</code> is a pleasant gray.</p>
<p>Now we need the <code>County</code> component.</p>
<div class="sourceCode" id="cb73" data-caption="County component"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb73-1" title="1"><span class="co">// src/components/CountyMap/County.js</span></a>
<a class="sourceLine" id="cb73-2" title="2"><span class="kw">class</span> County <span class="kw">extends</span> Component <span class="op">{</span></a>
<a class="sourceLine" id="cb73-3" title="3">    <span class="at">shouldComponentUpdate</span>(nextProps<span class="op">,</span> nextState) <span class="op">{</span></a>
<a class="sourceLine" id="cb73-4" title="4">        <span class="kw">const</span> <span class="op">{</span> zoom<span class="op">,</span> value <span class="op">}</span> <span class="op">=</span> <span class="kw">this</span>.<span class="at">props</span><span class="op">;</span></a>
<a class="sourceLine" id="cb73-5" title="5"></a>
<a class="sourceLine" id="cb73-6" title="6">        <span class="cf">return</span> zoom <span class="op">!==</span> <span class="va">nextProps</span>.<span class="at">zoom</span></a>
<a class="sourceLine" id="cb73-7" title="7">            <span class="op">||</span> value <span class="op">!==</span> <span class="va">nextProps</span>.<span class="at">value</span><span class="op">;</span></a>
<a class="sourceLine" id="cb73-8" title="8">    <span class="op">}</span></a>
<a class="sourceLine" id="cb73-9" title="9"></a>
<a class="sourceLine" id="cb73-10" title="10">    <span class="at">render</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb73-11" title="11">        <span class="kw">const</span> <span class="op">{</span> value<span class="op">,</span> geoPath<span class="op">,</span> feature<span class="op">,</span> quantize <span class="op">}</span> <span class="op">=</span> <span class="kw">this</span>.<span class="at">props</span><span class="op">;</span></a>
<a class="sourceLine" id="cb73-12" title="12"></a>
<a class="sourceLine" id="cb73-13" title="13">        <span class="kw">let</span> color <span class="op">=</span> BlankColor<span class="op">;</span></a>
<a class="sourceLine" id="cb73-14" title="14"></a>
<a class="sourceLine" id="cb73-15" title="15">        <span class="cf">if</span> (value) <span class="op">{</span></a>
<a class="sourceLine" id="cb73-16" title="16">            color <span class="op">=</span> ChoroplethColors[<span class="at">quantize</span>(value)]<span class="op">;</span></a>
<a class="sourceLine" id="cb73-17" title="17">        <span class="op">}</span></a>
<a class="sourceLine" id="cb73-18" title="18"></a>
<a class="sourceLine" id="cb73-19" title="19">        <span class="cf">return</span> (</a>
<a class="sourceLine" id="cb73-20" title="20">            <span class="op">&lt;</span>path d<span class="op">={</span><span class="at">geoPath</span>(feature)<span class="op">}</span></a>
<a class="sourceLine" id="cb73-21" title="21">                  style<span class="op">={{</span><span class="dt">fill</span><span class="op">:</span> color<span class="op">}}</span></a>
<a class="sourceLine" id="cb73-22" title="22">                  title<span class="op">={</span><span class="va">feature</span>.<span class="at">id</span><span class="op">}</span> /&gt;</a>
<a class="sourceLine" id="cb73-23" title="23">        )<span class="op">;</span></a>
<a class="sourceLine" id="cb73-24" title="24">    <span class="op">}</span></a>
<a class="sourceLine" id="cb73-25" title="25"><span class="op">}</span></a>
<a class="sourceLine" id="cb73-26" title="26"></a>
<a class="sourceLine" id="cb73-27" title="27"><span class="im">export</span> <span class="im">default</span> County<span class="op">;</span></a></code></pre></div>
<p>The <code>render</code> method uses a <code>quantize</code> scale to pick the right color and returns a <code>&lt;path&gt;</code> element. <code>geoPath</code> generates the <code>d</code> attribute, we set style to <code>fill</code> the color, and we give our path a <code>title</code>.</p>
<p><code>shouldComponentUpdate</code> is more interesting. It’s a React lifecycle method that lets you specify which prop changes are relevant to component re-rendering.</p>
<p><code>CountyMap</code> passes complex props - <code>quantize</code>, <code>geoPath</code>, and <code>feature</code>. They’re pass-by-reference instead of pass-by-value. That means React can’t see when their output changes unless you make completely new copies.</p>
<p>This can lead to all 3,220 counties re-rendering every time a user does anything. But they only have to re-render if we change the map zoom or if the county gets a new value.</p>
<p>Using <code>shouldComponentUpdate</code> like this we can go from 3,220 DOM updates to a few hundred. Big speed improvement</p>