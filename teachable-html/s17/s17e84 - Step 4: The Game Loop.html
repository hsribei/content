<h3 id="step-4-the-game-loop">Step 4: The Game Loop</h3>
<p>Our game loop is already running. It‚Äôs that <code>d3.timer</code> we started on component mount.</p>
<p>What do you think we should do every time <code>gameLoop</code> is called?</p>
<p>Move the ball. Accelerate. Bounce it back. üèÄ</p>
<p>The physics is tricky to think about. Few students at my workshops figure this one out and that‚Äôs the point: Game loop gives you control. All the control.</p>
<div class="sourceCode" id="cb127" data-caption="Bouncy ball at 60fps"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb127-1" title="1"><span class="co">// BouncingBall.js</span></a>
<a class="sourceLine" id="cb127-2" title="2">    <span class="at">componentDidMount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb127-3" title="3">        <span class="co">// start game loop</span></a>
<a class="sourceLine" id="cb127-4" title="4">        <span class="kw">this</span>.<span class="at">timer</span> <span class="op">=</span> <span class="va">d3</span>.<span class="at">timer</span>(<span class="kw">this</span>.<span class="at">gameLoop</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb127-5" title="5">    <span class="op">}</span></a>
<a class="sourceLine" id="cb127-6" title="6">    </a>
<a class="sourceLine" id="cb127-7" title="7">    <span class="at">componentWillUnmount</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb127-8" title="8">        <span class="kw">this</span>.<span class="va">timer</span>.<span class="at">stop</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb127-9" title="9">    <span class="op">}</span></a>
<a class="sourceLine" id="cb127-10" title="10">    </a>
<a class="sourceLine" id="cb127-11" title="11">    gameLoop <span class="op">=</span> () <span class="op">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb127-12" title="12">    <span class="kw">let</span> <span class="op">{</span> y<span class="op">,</span> vy <span class="op">}</span> <span class="op">=</span> <span class="kw">this</span>.<span class="at">state</span><span class="op">;</span></a>
<a class="sourceLine" id="cb127-13" title="13"></a>
<a class="sourceLine" id="cb127-14" title="14">    <span class="cf">if</span> (y <span class="op">&gt;</span> <span class="kw">this</span>.<span class="va">props</span>.<span class="at">max_h</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb127-15" title="15">      vy <span class="op">=</span> <span class="op">-</span>vy <span class="op">*</span> <span class="fl">.87</span><span class="op">;</span></a>
<a class="sourceLine" id="cb127-16" title="16">    <span class="op">}</span></a>
<a class="sourceLine" id="cb127-17" title="17"></a>
<a class="sourceLine" id="cb127-18" title="18">    <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb127-19" title="19">      <span class="dt">y</span><span class="op">:</span> y <span class="op">+</span> vy<span class="op">,</span></a>
<a class="sourceLine" id="cb127-20" title="20">      <span class="dt">vy</span><span class="op">:</span> vy <span class="op">+</span> <span class="fl">0.3</span></a>
<a class="sourceLine" id="cb127-21" title="21">    <span class="op">}</span>)</a>
<a class="sourceLine" id="cb127-22" title="22">  <span class="op">}</span></a></code></pre></div>
<p>Our <code>gameLoop</code> method is called every 16 milliseconds give or take. Sometimes more, if the computer is busy, low on batter, or the tab is left inactive for too long</p>
<p>Bounce physics go like this:</p>
<ul>
<li>add vertical speed, <code>vy</code>, to position, <code>y</code></li>
<li>increased <code>vy</code> by amount of acceleration</li>
<li>if position is more than max, bounce</li>
<li>bounce means invert speed</li>
<li>bounce means energy loss, reduce speed by 13%</li>
</ul>
<p>High school physics my friend. You might not remember.</p>
<p>Speed tells you how much an object moves per unit of time. Our speed starts at 5 pixels per frame.</p>
<p>Acceleration tells you how much speed increases per unit of time. Gravity makes you fall 10 meters per second faster every second. Our gravity looks best at 0.3 pixels per frame.</p>
<p>Bounce is what really breaks people‚Äôs brains.</p>
<p>I think it‚Äôs one of Newton‚Äôs laws? Or a derivation from there. Bouncing means balls maintain the same speed, but change direction. Our wall is perpendicular to the path of travel, so the speed inverts.</p>
<p>We add some energy loss to make the bounce more realistic.</p>
<p>Gravity acceleration points the same downwards direction as always. Except now it‚Äôs slowing down the ball instead of speeding it up.</p>
<p>Eventually speed reaches zero and the ball starts falling again.</p>
<figure>
<img src="https://media.giphy.com/media/12NUbkX6p4xOO4/giphy.gif" alt="Magic" /><figcaption>Magic</figcaption>
</figure>
<p>Here‚Äôs a CodeSandbox with the <a href="https://codesandbox.io/s/o4vk8zkn96">final bouncy ball code</a>.</p>
<p>Experiment with multiple balls. Start them at different heights. Play with different factors in those equations. It‚Äôs fun if you‚Äôre a nerd like me.</p>