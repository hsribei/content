<h2 id="step-3-histogram-component">Step 3: Histogram component</h2>
<p>We’re following the <a href="https://swizec1.teachable.com/courses/react-for-data-visualization/lectures/6887740#full-feature-integration">full-feature integration</a> approach for our Histogram component. React talks to the DOM, D3 calculates the props.</p>
<p>We’ll use two components:</p>
<ol type="1">
<li><code style="white-space: pre-wrap;">Histogram</code> makes the general layout, dealing with D3, and translating raw data into a histogram</li>
<li><code style="white-space: pre-wrap;">HistogramBar</code> draws a single bar and labels it</li>
</ol>
<p>Let’s start with the basics: a <code style="white-space: pre-wrap;">Histogram</code> directory and an <code style="white-space: pre-wrap;">index.js</code> file. Keeps our code organized and imports easy. I like to use directories for components made of multiple files.</p>
<div class="sourceCode" id="cb79" data-caption="Re-export Histogram" style="overflow: visible; margin: 1em 0;"><pre class="sourceCode javascript" style="overflow: visible; margin: 0;"><code class="sourceCode javascript" style="overflow: visible; white-space: pre; position: relative;"><a class="sourceLine" id="cb79-1" title="1" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="im">export</span> <span class="op" style="color: #666666;">{</span> <span class="im">default</span> <span class="op" style="color: #666666;">}</span> <span class="im">from</span> <span class="st" style="color: #4070a0;">&quot;./Histogram&quot;</span><span class="op" style="color: #666666;">;</span></a></code></pre></div>
<p>Import and re-export the histogram componenet from <code style="white-space: pre-wrap;">./Histogram</code>. This way you can keep your histogram code in a file called Histogram and pretend the directory itself is exporting it.</p>
<p>Great way to group files that belong together without exposing your directory’s internal structure.</p>
<p>Now we need the <code style="white-space: pre-wrap;">Histogram.js</code> file. Start with some imports, a default export, and a stubbed out <code style="white-space: pre-wrap;">Histogram</code> class.</p>
<div class="sourceCode" id="cb80" data-caption="Histogram component stub" style="overflow: visible; margin: 1em 0;"><pre class="sourceCode javascript" style="overflow: visible; margin: 0;"><code class="sourceCode javascript" style="overflow: visible; white-space: pre; position: relative;"><a class="sourceLine" id="cb80-1" title="1" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="co" style="color: #60a0b0; font-style: italic;">// src/components/Histogram/Histogram.js</span></a>
<a class="sourceLine" id="cb80-2" title="2" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="im">import</span> React <span class="im">from</span> <span class="st" style="color: #4070a0;">&quot;react&quot;</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb80-3" title="3" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="im">import</span> <span class="op" style="color: #666666;">*</span> <span class="im">as</span> d3 <span class="im">from</span> <span class="st" style="color: #4070a0;">&quot;d3&quot;</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb80-4" title="4" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-5" title="5" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="kw" style="color: #007020; font-weight: bold;">class</span> Histogram <span class="kw" style="color: #007020; font-weight: bold;">extends</span> <span class="va" style="color: #19177c;">React</span>.<span class="at" style="color: #7d9029;">Component</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb80-6" title="6" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    state <span class="op" style="color: #666666;">=</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb80-7" title="7" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="dt" style="color: #902000;">histogram</span><span class="op" style="color: #666666;">:</span> <span class="va" style="color: #19177c;">d3</span>.<span class="at" style="color: #7d9029;">histogram</span>()<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb80-8" title="8" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="dt" style="color: #902000;">widthScale</span><span class="op" style="color: #666666;">:</span> <span class="va" style="color: #19177c;">d3</span>.<span class="at" style="color: #7d9029;">scaleLinear</span>()<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb80-9" title="9" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="dt" style="color: #902000;">yScale</span><span class="op" style="color: #666666;">:</span> <span class="va" style="color: #19177c;">d3</span>.<span class="at" style="color: #7d9029;">scaleLinear</span>()</a>
<a class="sourceLine" id="cb80-10" title="10" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">};</span></a>
<a class="sourceLine" id="cb80-11" title="11" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-12" title="12" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="kw" style="color: #007020; font-weight: bold;">static</span> <span class="at" style="color: #7d9029;">getDerivedStateFromProps</span>(props<span class="op" style="color: #666666;">,</span> state) <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb80-13" title="13" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">let</span> <span class="op" style="color: #666666;">{</span> histogram<span class="op" style="color: #666666;">,</span> widthScale<span class="op" style="color: #666666;">,</span> yScale <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> state<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb80-14" title="14" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-15" title="15" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="cf" style="color: #007020; font-weight: bold;">return</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb80-16" title="16" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            ...<span class="at" style="color: #7d9029;">state</span><span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb80-17" title="17" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            histogram<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb80-18" title="18" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            widthScale<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb80-19" title="19" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            yScale</a>
<a class="sourceLine" id="cb80-20" title="20" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="op" style="color: #666666;">};</span></a>
<a class="sourceLine" id="cb80-21" title="21" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">}</span></a>
<a class="sourceLine" id="cb80-22" title="22" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-23" title="23" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    makeBar <span class="op" style="color: #666666;">=</span> bar <span class="kw" style="color: #007020; font-weight: bold;">=&gt;</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb80-24" title="24" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">const</span> <span class="op" style="color: #666666;">{</span> yScale<span class="op" style="color: #666666;">,</span> widthScale <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">state</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb80-25" title="25" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-26" title="26" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">};</span></a>
<a class="sourceLine" id="cb80-27" title="27" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-28" title="28" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="at" style="color: #7d9029;">render</span>() <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb80-29" title="29" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">const</span> <span class="op" style="color: #666666;">{</span> histogram<span class="op" style="color: #666666;">,</span> yScale <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">state</span><span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb80-30" title="30" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="op" style="color: #666666;">{</span> x<span class="op" style="color: #666666;">,</span> y<span class="op" style="color: #666666;">,</span> data<span class="op" style="color: #666666;">,</span> axisMargin <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">props</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb80-31" title="31" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb80-32" title="32" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="cf" style="color: #007020; font-weight: bold;">return</span> <span class="kw" style="color: #007020; font-weight: bold;">null</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb80-33" title="33" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">}</span></a>
<a class="sourceLine" id="cb80-34" title="34" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="op" style="color: #666666;">}</span></a></code></pre></div>
<p>We import React and D3, and set up <code style="white-space: pre-wrap;">Histogram</code>.</p>
<p>Default <code style="white-space: pre-wrap;">state</code> for our D3 objects: histogram, widthScale, and yScale. An empty <code style="white-space: pre-wrap;">getDerivedStateFromProps</code> to keep them updated, <code style="white-space: pre-wrap;">makeBar</code> to help us render each bar, and <code style="white-space: pre-wrap;">render</code> returning null for now.</p>
<h3 id="getderivedstatefromprops-1">getDerivedStateFromProps</h3>
<div class="sourceCode" id="cb81" data-caption="getDerivedStateFromProps in Histogram" style="overflow: visible; margin: 1em 0;"><pre class="sourceCode javascript" style="overflow: visible; margin: 0;"><code class="sourceCode javascript" style="overflow: visible; white-space: pre; position: relative;"><a class="sourceLine" id="cb81-1" title="1" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="co" style="color: #60a0b0; font-style: italic;">// src/components/Histogram/Histogram.js</span></a>
<a class="sourceLine" id="cb81-2" title="2" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="kw" style="color: #007020; font-weight: bold;">static</span> <span class="at" style="color: #7d9029;">getDerivedStateFromProps</span>(props<span class="op" style="color: #666666;">,</span> state) <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb81-3" title="3" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">let</span> <span class="op" style="color: #666666;">{</span> histogram<span class="op" style="color: #666666;">,</span> widthScale<span class="op" style="color: #666666;">,</span> yScale <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> state<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb81-4" title="4" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb81-5" title="5" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="va" style="color: #19177c;">histogram</span>.<span class="at" style="color: #7d9029;">thresholds</span>(<span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">bins</span>).<span class="at" style="color: #7d9029;">value</span>(<span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">value</span>)<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb81-6" title="6" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb81-7" title="7" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">const</span> bars <span class="op" style="color: #666666;">=</span> <span class="at" style="color: #7d9029;">histogram</span>(<span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">data</span>)<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb81-8" title="8" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            counts <span class="op" style="color: #666666;">=</span> <span class="va" style="color: #19177c;">bars</span>.<span class="at" style="color: #7d9029;">map</span>(d <span class="kw" style="color: #007020; font-weight: bold;">=&gt;</span> <span class="va" style="color: #19177c;">d</span>.<span class="at" style="color: #7d9029;">length</span>)<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb81-9" title="9" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb81-10" title="10" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        widthScale</a>
<a class="sourceLine" id="cb81-11" title="11" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            .<span class="at" style="color: #7d9029;">domain</span>([<span class="va" style="color: #19177c;">d3</span>.<span class="at" style="color: #7d9029;">min</span>(counts)<span class="op" style="color: #666666;">,</span> <span class="va" style="color: #19177c;">d3</span>.<span class="at" style="color: #7d9029;">max</span>(counts)])</a>
<a class="sourceLine" id="cb81-12" title="12" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            .<span class="at" style="color: #7d9029;">range</span>([<span class="dv" style="color: #40a070;">0</span><span class="op" style="color: #666666;">,</span> <span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">width</span> <span class="op" style="color: #666666;">-</span> <span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">axisMargin</span>])<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb81-13" title="13" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb81-14" title="14" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        yScale</a>
<a class="sourceLine" id="cb81-15" title="15" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            .<span class="at" style="color: #7d9029;">domain</span>([<span class="dv" style="color: #40a070;">0</span><span class="op" style="color: #666666;">,</span> <span class="va" style="color: #19177c;">d3</span>.<span class="at" style="color: #7d9029;">max</span>(bars<span class="op" style="color: #666666;">,</span> d <span class="kw" style="color: #007020; font-weight: bold;">=&gt;</span> <span class="va" style="color: #19177c;">d</span>.<span class="at" style="color: #7d9029;">x1</span>)])</a>
<a class="sourceLine" id="cb81-16" title="16" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            .<span class="at" style="color: #7d9029;">range</span>([<span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">height</span> <span class="op" style="color: #666666;">-</span> <span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">y</span> <span class="op" style="color: #666666;">-</span> <span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">bottomMargin</span><span class="op" style="color: #666666;">,</span> <span class="dv" style="color: #40a070;">0</span>])<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb81-17" title="17" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb81-18" title="18" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="cf" style="color: #007020; font-weight: bold;">return</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb81-19" title="19" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            ...<span class="at" style="color: #7d9029;">state</span><span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb81-20" title="20" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            histogram<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb81-21" title="21" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            widthScale<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb81-22" title="22" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            yScale</a>
<a class="sourceLine" id="cb81-23" title="23" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="op" style="color: #666666;">};</span></a>
<a class="sourceLine" id="cb81-24" title="24" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">}</span></a></code></pre></div>
<p>First, we configure the <code style="white-space: pre-wrap;">histogram</code> generator. <code style="white-space: pre-wrap;">thresholds</code> specify how many bins we want and <code style="white-space: pre-wrap;">value</code> specifies the value accessor function. We get both from props passed into the <code style="white-space: pre-wrap;">Histogram</code> component.</p>
<p>In our case that makes 20 bins, and the value accessor returns each data point’s <code style="white-space: pre-wrap;">base_salary</code>.</p>
<p>We feed the data prop into our histogram generator, and count how many values are in each bin with a <code style="white-space: pre-wrap;">.map</code> call. We need those to configure our scales.</p>
<p>If you print the result of <code style="white-space: pre-wrap;">histogram()</code>, you’ll see an array structure where each entry holds metadata about the bin and the values it contains.</p>
<figure>
<img src="https://raw.githubusercontent.com/Swizec/react-d3js-es6-ebook/2018-version/manuscript/resources/images/es6v2/histogram-data-screenshot.png" alt="console.log(this.histogram())"><figcaption>console.log(this.histogram())</figcaption>
</figure>
<p>Let’s use this info to set up our scales.</p>
<p><code style="white-space: pre-wrap;">widthScale</code> has a range from the smallest (<code style="white-space: pre-wrap;">d3.min</code>) bin to the largest (<code style="white-space: pre-wrap;">d3.max</code>), and a range of <code style="white-space: pre-wrap;">0</code> to width less a margin. We’ll use it to calculate bar sizes.</p>
<p><code style="white-space: pre-wrap;">yScale</code> has a range from <code style="white-space: pre-wrap;">0</code> to the largest <code style="white-space: pre-wrap;">x1</code> coordinate we can find in a bin. Bins go from <code style="white-space: pre-wrap;">x0</code> to <code style="white-space: pre-wrap;">x1</code>, which reflects the fact that most histograms are horizontally oriented. Ours is vertical so that our labels are easier to read. The range goes from <code style="white-space: pre-wrap;">0</code> to the maximum height less a margin.</p>
<p>Now let’s render this puppy.</p>
<h3 id="render-1">render</h3>
<div class="sourceCode" id="cb82" data-caption="Histogram.render" style="overflow: visible; margin: 1em 0;"><pre class="sourceCode javascript" style="overflow: visible; margin: 0;"><code class="sourceCode javascript" style="overflow: visible; white-space: pre; position: relative;"><a class="sourceLine" id="cb82-1" title="1" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="co" style="color: #60a0b0; font-style: italic;">// src/components/Histogram/Histogram.js</span></a>
<a class="sourceLine" id="cb82-2" title="2" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="kw" style="color: #007020; font-weight: bold;">class</span> Histogram <span class="kw" style="color: #007020; font-weight: bold;">extends</span> <span class="va" style="color: #19177c;">React</span>.<span class="at" style="color: #7d9029;">Component</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb82-3" title="3" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="co" style="color: #60a0b0; font-style: italic;">// ...</span></a>
<a class="sourceLine" id="cb82-4" title="4" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="at" style="color: #7d9029;">render</span>() <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb82-5" title="5" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">const</span> <span class="op" style="color: #666666;">{</span> histogram<span class="op" style="color: #666666;">,</span> yScale <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">state</span><span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb82-6" title="6" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="op" style="color: #666666;">{</span> x<span class="op" style="color: #666666;">,</span> y<span class="op" style="color: #666666;">,</span> data<span class="op" style="color: #666666;">,</span> axisMargin <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">props</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb82-7" title="7" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb82-8" title="8" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">const</span> bars <span class="op" style="color: #666666;">=</span> <span class="at" style="color: #7d9029;">histogram</span>(data)<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb82-9" title="9" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb82-10" title="10" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="cf" style="color: #007020; font-weight: bold;">return</span> (</a>
<a class="sourceLine" id="cb82-11" title="11" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="op" style="color: #666666;">&lt;</span>g className<span class="op" style="color: #666666;">=</span><span class="st" style="color: #4070a0;">&quot;histogram&quot;</span> transform<span class="op" style="color: #666666;">={</span><span class="vs" style="color: #4070a0;">`translate(</span><span class="sc" style="color: #4070a0;">${</span>x<span class="sc" style="color: #4070a0;">}</span><span class="vs" style="color: #4070a0;">, </span><span class="sc" style="color: #4070a0;">${</span>y<span class="sc" style="color: #4070a0;">}</span><span class="vs" style="color: #4070a0;">)`</span><span class="op" style="color: #666666;">}&gt;</span></a>
<a class="sourceLine" id="cb82-12" title="12" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">                <span class="op" style="color: #666666;">&lt;</span>g className<span class="op" style="color: #666666;">=</span><span class="st" style="color: #4070a0;">&quot;bars&quot;</span><span class="op" style="color: #666666;">&gt;</span></a>
<a class="sourceLine" id="cb82-13" title="13" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">                    <span class="op" style="color: #666666;">{</span><span class="va" style="color: #19177c;">bars</span>.<span class="at" style="color: #7d9029;">map</span>(<span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">makeBar</span>))<span class="op" style="color: #666666;">}</span></a>
<a class="sourceLine" id="cb82-14" title="14" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">                &lt;/g<span class="op" style="color: #666666;">&gt;</span></a>
<a class="sourceLine" id="cb82-15" title="15" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            &lt;/g<span class="op" style="color: #666666;">&gt;</span></a>
<a class="sourceLine" id="cb82-16" title="16" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        )<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb82-17" title="17" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">}</span></a>
<a class="sourceLine" id="cb82-18" title="18" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="op" style="color: #666666;">}</span></a></code></pre></div>
<p>We take everything we need out of <code style="white-space: pre-wrap;">state</code> and <code style="white-space: pre-wrap;">props</code> with destructuring, call <code style="white-space: pre-wrap;">histogram()</code> on our data to get a list of bars, and render.</p>
<p>Our render method returns a <code style="white-space: pre-wrap;">&lt;g&gt;</code> grouping element transformed to the position given in props and walks through the <code style="white-space: pre-wrap;">bars</code> array, calling <code style="white-space: pre-wrap;">makeBar</code> for each. Later, we’re going to add an <code style="white-space: pre-wrap;">Axis</code> as well.</p>
<p>This is a great example of React’s declarativeness. We have a bunch of stuff, and all it takes to render is a loop. No worrying about how it renders, where it goes, or anything like that. Walk through data, render, done.</p>
<h3 id="makebar">makeBar</h3>
<p><code style="white-space: pre-wrap;">makeBar</code> is a function that takes a histogram bar’s metadata and returns a <code style="white-space: pre-wrap;">HistogramBar</code> component. We use it to make our declarative loop more readable.</p>
<div class="sourceCode" id="cb83" data-caption="Histogram.makeBar" style="overflow: visible; margin: 1em 0;"><pre class="sourceCode javascript" style="overflow: visible; margin: 0;"><code class="sourceCode javascript" style="overflow: visible; white-space: pre; position: relative;"><a class="sourceLine" id="cb83-1" title="1" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="co" style="color: #60a0b0; font-style: italic;">// src/components/Histogram/Histogram.js</span></a>
<a class="sourceLine" id="cb83-2" title="2" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="kw" style="color: #007020; font-weight: bold;">class</span> Histogram <span class="kw" style="color: #007020; font-weight: bold;">extends</span> <span class="va" style="color: #19177c;">React</span>.<span class="at" style="color: #7d9029;">Component</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb83-3" title="3" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="co" style="color: #60a0b0; font-style: italic;">// ...</span></a>
<a class="sourceLine" id="cb83-4" title="4" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    makeBar <span class="op" style="color: #666666;">=</span> bar <span class="kw" style="color: #007020; font-weight: bold;">=&gt;</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb83-5" title="5" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">const</span> <span class="op" style="color: #666666;">{</span> yScale<span class="op" style="color: #666666;">,</span> widthScale <span class="op" style="color: #666666;">}</span> <span class="op" style="color: #666666;">=</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="at" style="color: #7d9029;">state</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb83-6" title="6" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb83-7" title="7" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">let</span> percent <span class="op" style="color: #666666;">=</span> (<span class="va" style="color: #19177c;">bar</span>.<span class="at" style="color: #7d9029;">length</span> / <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="va" style="color: #19177c;">props</span>.<span class="va" style="color: #19177c;">data</span>.<span class="at" style="color: #7d9029;">length</span>) <span class="op" style="color: #666666;">*</span> <span class="dv" style="color: #40a070;">100</span><span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb83-8" title="8" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb83-9" title="9" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="kw" style="color: #007020; font-weight: bold;">let</span> props <span class="op" style="color: #666666;">=</span> <span class="op" style="color: #666666;">{</span></a>
<a class="sourceLine" id="cb83-10" title="10" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="dt" style="color: #902000;">percent</span><span class="op" style="color: #666666;">:</span> percent<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb83-11" title="11" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="dt" style="color: #902000;">x</span><span class="op" style="color: #666666;">:</span> <span class="kw" style="color: #007020; font-weight: bold;">this</span>.<span class="va" style="color: #19177c;">props</span>.<span class="at" style="color: #7d9029;">axisMargin</span><span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb83-12" title="12" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="dt" style="color: #902000;">y</span><span class="op" style="color: #666666;">:</span> <span class="at" style="color: #7d9029;">yScale</span>(<span class="va" style="color: #19177c;">bar</span>.<span class="at" style="color: #7d9029;">x1</span>)<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb83-13" title="13" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="dt" style="color: #902000;">width</span><span class="op" style="color: #666666;">:</span> <span class="at" style="color: #7d9029;">widthScale</span>(<span class="va" style="color: #19177c;">bar</span>.<span class="at" style="color: #7d9029;">length</span>)<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb83-14" title="14" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="dt" style="color: #902000;">height</span><span class="op" style="color: #666666;">:</span> <span class="at" style="color: #7d9029;">yScale</span>(<span class="va" style="color: #19177c;">bar</span>.<span class="at" style="color: #7d9029;">x0</span>) <span class="op" style="color: #666666;">-</span> <span class="at" style="color: #7d9029;">yScale</span>(<span class="va" style="color: #19177c;">bar</span>.<span class="at" style="color: #7d9029;">x1</span>)<span class="op" style="color: #666666;">,</span></a>
<a class="sourceLine" id="cb83-15" title="15" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">            <span class="dt" style="color: #902000;">key</span><span class="op" style="color: #666666;">:</span> <span class="st" style="color: #4070a0;">&quot;histogram-bar-&quot;</span> <span class="op" style="color: #666666;">+</span> <span class="va" style="color: #19177c;">bar</span>.<span class="at" style="color: #7d9029;">x0</span></a>
<a class="sourceLine" id="cb83-16" title="16" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="op" style="color: #666666;">};</span></a>
<a class="sourceLine" id="cb83-17" title="17" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit; height: 1.2em;"></a>
<a class="sourceLine" id="cb83-18" title="18" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">        <span class="cf" style="color: #007020; font-weight: bold;">return</span> <span class="op" style="color: #666666;">&lt;</span>HistogramBar <span class="op" style="color: #666666;">{</span>...<span class="at" style="color: #7d9029;">props</span><span class="op" style="color: #666666;">}</span> /&gt;<span class="op" style="color: #666666;">;</span></a>
<a class="sourceLine" id="cb83-19" title="19" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;">    <span class="op" style="color: #666666;">};</span></a>
<a class="sourceLine" id="cb83-20" title="20" style="display: inline-block; line-height: 1.25; pointer-events: none; color: inherit; text-decoration: inherit;"><span class="op" style="color: #666666;">}</span></a></code></pre></div>
<p>See, we’re calculating <code style="white-space: pre-wrap;">props</code> and feeding them into <code style="white-space: pre-wrap;">HistogramBar</code>. Putting it in a separate function just makes the <code style="white-space: pre-wrap;">.map</code> construct in <code style="white-space: pre-wrap;">render</code> easier to read. There’s a lot of props to calculate.</p>
<p>Some, like <code style="white-space: pre-wrap;">axisMargin</code> we pass through, others like <code style="white-space: pre-wrap;">width</code> and <code style="white-space: pre-wrap;">height</code> we calculate using our scales.</p>
<p>Setting the <code style="white-space: pre-wrap;">key</code> prop is important. React uses it to tell the bars apart and only re-render those that change.</p>