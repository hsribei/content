<h3 id="ball.js-state-transition">Ball.js state transition</h3>
<p>What does move our ball, is our transition. We do that in <code>componentDidUpdate</code>.</p>
<div class="sourceCode" id="cb131" data-caption="D3 transition our ball"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb131-1" title="1">  <span class="at">componentDidUpdate</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb131-2" title="2">    <span class="kw">let</span> el <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="kw">this</span>.<span class="va">circleRef</span>.<span class="at">current</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb131-3" title="3"></a>
<a class="sourceLine" id="cb131-4" title="4">    <span class="va">el</span>.<span class="at">transition</span>()</a>
<a class="sourceLine" id="cb131-5" title="5">      .<span class="at">duration</span>(<span class="dv">800</span>)</a>
<a class="sourceLine" id="cb131-6" title="6">      .<span class="at">ease</span>(<span class="va">d3</span>.<span class="at">easeBounceOut</span>)</a>
<a class="sourceLine" id="cb131-7" title="7">      .<span class="at">attr</span>(<span class="st">&quot;cx&quot;</span><span class="op">,</span> <span class="kw">this</span>.<span class="va">props</span>.<span class="at">x</span>)</a>
<a class="sourceLine" id="cb131-8" title="8">      .<span class="at">on</span>(<span class="st">&quot;end&quot;</span><span class="op">,</span> () <span class="op">=&gt;</span></a>
<a class="sourceLine" id="cb131-9" title="9">        <span class="kw">this</span>.<span class="at">setState</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb131-10" title="10">          <span class="dt">x</span><span class="op">:</span> <span class="kw">this</span>.<span class="va">props</span>.<span class="at">x</span></a>
<a class="sourceLine" id="cb131-11" title="11">        <span class="op">}</span>)</a>
<a class="sourceLine" id="cb131-12" title="12">      )<span class="op">;</span></a>
<a class="sourceLine" id="cb131-13" title="13">  <span class="op">}</span></a></code></pre></div>
<p>React calls <code>componentDidUpdate</code> when props or state change. We use this as an opportunity to run a D3 transition on our DOM node.</p>
<p>Hereâ€™s what happens:</p>
<ol type="1">
<li>Take the node with <code>d3.select</code></li>
<li>Start a transition with <code>.transition</code></li>
<li>Specify 800ms duration with <code>.duration</code></li>
<li>Add an easing function for that beautiful bounce effect with <code>.ease</code></li>
<li>Define which attributes are changing with <code>.attr</code></li>
<li>Use <code>.on(&quot;end&quot;)</code> to sync React worldview with reality after transition ends</li>
</ol>
<p>Whatâ€™s great about D3 transitions is that D3 figures everything for you. You can throw as many attributes at a transition as you want. The attributes can be as complex as you can imagine.</p>
<p>D3â€™s interpolation methods will figure it out for you. Numbers, strings, colors, it all works great.</p>
<p>After a transition is done, I like to sync Reactâ€™s worldview with what the transition changed. Itâ€™s not strictly required but it can sometimes lead to React freaking out that you moved an element.</p>
<p>Play around. Try adding some more transitions. Make the ball move diagonally. Make it go right then down. Itâ€™s fun. ðŸ˜Š</p>