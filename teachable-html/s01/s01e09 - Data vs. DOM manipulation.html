<h3 id="data-manipulation-vs.dom-manipulation">1) Data manipulation vs. DOM manipulation</h3>
<p>All D3 examples are split into two parts:</p>
<ol type="1">
<li>Data manipulation</li>
<li>DOM manipulation</li>
</ol>
<p>First you prep your values, then you render.</p>
<p>You have to go through many examples to notice what’s going on. Inference learning is hard. Most beginners miss this pattern and it makes D3 look more confusing than it is.</p>
<p>Let’s take an example from <a href="https://github.com/d3/d3/wiki/Gallery">D3’s docs</a>, a bar chart with a hover effect.</p>
<figure>
<img src="https://raw.githubusercontent.com/Swizec/react-d3js-es6-ebook/2018-version/manuscript/resources/images/2018/barchart-example.png" alt="An example D3 barchart" /><figcaption>An example D3 barchart</figcaption>
</figure>
<p>You can <a href="https://cdn.rawgit.com/mbostock/3885304/raw/a91f37f5f4b43269df3dbabcda0090310c05285d/index.html">try it online</a>. When you hover on a bar, it changes color. Pretty neat.</p>
<p>Mike Bostock, the creator of D3, built this chart in 43 lines of code. Here they are 👇</p>
<div class="sourceCode" id="cb7" data-caption="Example D3 barchart"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">var</span> svg <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb7-2" title="2">    margin <span class="op">=</span> <span class="op">{</span><span class="dt">top</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">40</span><span class="op">},</span></a>
<a class="sourceLine" id="cb7-3" title="3">    width <span class="op">=</span> <span class="op">+</span><span class="va">svg</span>.<span class="at">attr</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span> <span class="va">margin</span>.<span class="at">left</span> <span class="op">-</span> <span class="va">margin</span>.<span class="at">right</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-4" title="4">    height <span class="op">=</span> <span class="op">+</span><span class="va">svg</span>.<span class="at">attr</span>(<span class="st">&quot;height&quot;</span>) <span class="op">-</span> <span class="va">margin</span>.<span class="at">top</span> <span class="op">-</span> <span class="va">margin</span>.<span class="at">bottom</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="kw">var</span> x <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleBand</span>().<span class="at">rangeRound</span>([<span class="dv">0</span><span class="op">,</span> width]).<span class="at">padding</span>(<span class="fl">0.1</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb7-7" title="7">    y <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleLinear</span>().<span class="at">rangeRound</span>([height<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb7-8" title="8"></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="kw">var</span> g <span class="op">=</span> <span class="va">svg</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)</a>
<a class="sourceLine" id="cb7-10" title="10">    .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(&quot;</span> <span class="op">+</span> <span class="va">margin</span>.<span class="at">left</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="va">margin</span>.<span class="at">top</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-11" title="11"></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="va">d3</span>.<span class="at">tsv</span>(<span class="st">&quot;data.tsv&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-13" title="13">  <span class="va">d</span>.<span class="at">frequency</span> <span class="op">=</span> <span class="op">+</span><span class="va">d</span>.<span class="at">frequency</span><span class="op">;</span></a>
<a class="sourceLine" id="cb7-14" title="14">  <span class="cf">return</span> d<span class="op">;</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="op">},</span> <span class="kw">function</span>(error<span class="op">,</span> data) <span class="op">{</span></a>
<a class="sourceLine" id="cb7-16" title="16">  <span class="cf">if</span> (error) <span class="cf">throw</span> error<span class="op">;</span></a>
<a class="sourceLine" id="cb7-17" title="17"></a>
<a class="sourceLine" id="cb7-18" title="18">  <span class="va">x</span>.<span class="at">domain</span>(<span class="va">data</span>.<span class="at">map</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">letter</span><span class="op">;</span> <span class="op">}</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb7-19" title="19">  <span class="va">y</span>.<span class="at">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="va">d3</span>.<span class="at">max</span>(data<span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">frequency</span><span class="op">;</span> <span class="op">}</span>)])<span class="op">;</span></a>
<a class="sourceLine" id="cb7-20" title="20"></a>
<a class="sourceLine" id="cb7-21" title="21">  <span class="va">g</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)</a>
<a class="sourceLine" id="cb7-22" title="22">      .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;axis axis--x&quot;</span>)</a>
<a class="sourceLine" id="cb7-23" title="23">      .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(0,&quot;</span> <span class="op">+</span> height <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb7-24" title="24">      .<span class="at">call</span>(<span class="va">d3</span>.<span class="at">axisBottom</span>(x))<span class="op">;</span></a>
<a class="sourceLine" id="cb7-25" title="25"></a>
<a class="sourceLine" id="cb7-26" title="26">  <span class="va">g</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)</a>
<a class="sourceLine" id="cb7-27" title="27">      .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;axis axis--y&quot;</span>)</a>
<a class="sourceLine" id="cb7-28" title="28">      .<span class="at">call</span>(<span class="va">d3</span>.<span class="at">axisLeft</span>(y).<span class="at">ticks</span>(<span class="dv">10</span><span class="op">,</span> <span class="st">&quot;%&quot;</span>))</a>
<a class="sourceLine" id="cb7-29" title="29">    .<span class="at">append</span>(<span class="st">&quot;text&quot;</span>)</a>
<a class="sourceLine" id="cb7-30" title="30">      .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;rotate(-90)&quot;</span>)</a>
<a class="sourceLine" id="cb7-31" title="31">      .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb7-32" title="32">      .<span class="at">attr</span>(<span class="st">&quot;dy&quot;</span><span class="op">,</span> <span class="st">&quot;0.71em&quot;</span>)</a>
<a class="sourceLine" id="cb7-33" title="33">      .<span class="at">attr</span>(<span class="st">&quot;text-anchor&quot;</span><span class="op">,</span> <span class="st">&quot;end&quot;</span>)</a>
<a class="sourceLine" id="cb7-34" title="34">      .<span class="at">text</span>(<span class="st">&quot;Frequency&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-35" title="35"></a>
<a class="sourceLine" id="cb7-36" title="36">  <span class="va">g</span>.<span class="at">selectAll</span>(<span class="st">&quot;.bar&quot;</span>)</a>
<a class="sourceLine" id="cb7-37" title="37">    .<span class="at">data</span>(data)</a>
<a class="sourceLine" id="cb7-38" title="38">    .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)</a>
<a class="sourceLine" id="cb7-39" title="39">      .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;bar&quot;</span>)</a>
<a class="sourceLine" id="cb7-40" title="40">      .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">x</span>(<span class="va">d</span>.<span class="at">letter</span>)<span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-41" title="41">      .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">y</span>(<span class="va">d</span>.<span class="at">frequency</span>)<span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb7-42" title="42">      .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="va">x</span>.<span class="at">bandwidth</span>())</a>
<a class="sourceLine" id="cb7-43" title="43">      .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> height <span class="op">-</span> <span class="at">y</span>(<span class="va">d</span>.<span class="at">frequency</span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>There are two parts to this code: Data manipulation and DOM manipulation.</p>
<div class="sourceCode" id="cb8" data-caption="Data manipulation code"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1"><span class="kw">var</span> <span class="co">// ..,</span></a>
<a class="sourceLine" id="cb8-2" title="2">    margin <span class="op">=</span> <span class="op">{</span><span class="dt">top</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">right</span><span class="op">:</span> <span class="dv">20</span><span class="op">,</span> <span class="dt">bottom</span><span class="op">:</span> <span class="dv">30</span><span class="op">,</span> <span class="dt">left</span><span class="op">:</span> <span class="dv">40</span><span class="op">},</span></a>
<a class="sourceLine" id="cb8-3" title="3">    width <span class="op">=</span> <span class="op">+</span><span class="va">svg</span>.<span class="at">attr</span>(<span class="st">&quot;width&quot;</span>) <span class="op">-</span> <span class="va">margin</span>.<span class="at">left</span> <span class="op">-</span> <span class="va">margin</span>.<span class="at">right</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-4" title="4">    height <span class="op">=</span> <span class="op">+</span><span class="va">svg</span>.<span class="at">attr</span>(<span class="st">&quot;height&quot;</span>) <span class="op">-</span> <span class="va">margin</span>.<span class="at">top</span> <span class="op">-</span> <span class="va">margin</span>.<span class="at">bottom</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-5" title="5"></a>
<a class="sourceLine" id="cb8-6" title="6"><span class="kw">var</span> x <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleBand</span>().<span class="at">rangeRound</span>([<span class="dv">0</span><span class="op">,</span> width]).<span class="at">padding</span>(<span class="fl">0.1</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb8-7" title="7">    y <span class="op">=</span> <span class="va">d3</span>.<span class="at">scaleLinear</span>().<span class="at">rangeRound</span>([height<span class="op">,</span> <span class="dv">0</span>])<span class="op">;</span></a>
<a class="sourceLine" id="cb8-8" title="8"></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb8-10" title="10"></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="va">d3</span>.<span class="at">tsv</span>(<span class="st">&quot;data.tsv&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="va">d</span>.<span class="at">frequency</span> <span class="op">=</span> <span class="op">+</span><span class="va">d</span>.<span class="at">frequency</span><span class="op">;</span></a>
<a class="sourceLine" id="cb8-13" title="13">  <span class="cf">return</span> d<span class="op">;</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="op">},</span> <span class="kw">function</span>(error<span class="op">,</span> data) <span class="op">{</span></a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="cf">if</span> (error) <span class="cf">throw</span> error<span class="op">;</span></a>
<a class="sourceLine" id="cb8-16" title="16"></a>
<a class="sourceLine" id="cb8-17" title="17">  <span class="va">x</span>.<span class="at">domain</span>(<span class="va">data</span>.<span class="at">map</span>(<span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">letter</span><span class="op">;</span> <span class="op">}</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb8-18" title="18">  <span class="va">y</span>.<span class="at">domain</span>([<span class="dv">0</span><span class="op">,</span> <span class="va">d3</span>.<span class="at">max</span>(data<span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="va">d</span>.<span class="at">frequency</span><span class="op">;</span> <span class="op">}</span>)])<span class="op">;</span></a>
<a class="sourceLine" id="cb8-19" title="19"></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co">// ...</span></a>
<a class="sourceLine" id="cb8-21" title="21"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Bostock here first prepares his data:</p>
<ul>
<li>some sizing variables (<code>margin</code>, <code>width</code>, <code>height</code>)</li>
<li>two scales to help with data-to-coordinates conversion (<code>x, y</code>)</li>
<li>loads his dataset (<code>d3.tsv</code>) and updates his scales’ domains</li>
</ul>
<p>In the DOM manipulation part, he puts shapes and objects into an SVG. This is the part that shows up in your browser.</p>
<div class="sourceCode" id="cb9" data-caption="DOM manipulation code"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">var</span> svg <span class="op">=</span> <span class="va">d3</span>.<span class="at">select</span>(<span class="st">&quot;svg&quot;</span>)<span class="op">,</span></a>
<a class="sourceLine" id="cb9-2" title="2">    <span class="co">// ..</span></a>
<a class="sourceLine" id="cb9-3" title="3">    </a>
<a class="sourceLine" id="cb9-4" title="4"><span class="co">// ..</span></a>
<a class="sourceLine" id="cb9-5" title="5"></a>
<a class="sourceLine" id="cb9-6" title="6"><span class="kw">var</span> g <span class="op">=</span> <span class="va">svg</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)</a>
<a class="sourceLine" id="cb9-7" title="7">    .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(&quot;</span> <span class="op">+</span> <span class="va">margin</span>.<span class="at">left</span> <span class="op">+</span> <span class="st">&quot;,&quot;</span> <span class="op">+</span> <span class="va">margin</span>.<span class="at">top</span> <span class="op">+</span> <span class="st">&quot;)&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-8" title="8"></a>
<a class="sourceLine" id="cb9-9" title="9"><span class="co">// ..</span></a>
<a class="sourceLine" id="cb9-10" title="10">  <span class="va">g</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)</a>
<a class="sourceLine" id="cb9-11" title="11">      .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;axis axis--x&quot;</span>)</a>
<a class="sourceLine" id="cb9-12" title="12">      .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;translate(0,&quot;</span> <span class="op">+</span> height <span class="op">+</span> <span class="st">&quot;)&quot;</span>)</a>
<a class="sourceLine" id="cb9-13" title="13">      .<span class="at">call</span>(<span class="va">d3</span>.<span class="at">axisBottom</span>(x))<span class="op">;</span></a>
<a class="sourceLine" id="cb9-14" title="14"></a>
<a class="sourceLine" id="cb9-15" title="15">  <span class="va">g</span>.<span class="at">append</span>(<span class="st">&quot;g&quot;</span>)</a>
<a class="sourceLine" id="cb9-16" title="16">      .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;axis axis--y&quot;</span>)</a>
<a class="sourceLine" id="cb9-17" title="17">      .<span class="at">call</span>(<span class="va">d3</span>.<span class="at">axisLeft</span>(y).<span class="at">ticks</span>(<span class="dv">10</span><span class="op">,</span> <span class="st">&quot;%&quot;</span>))</a>
<a class="sourceLine" id="cb9-18" title="18">    .<span class="at">append</span>(<span class="st">&quot;text&quot;</span>)</a>
<a class="sourceLine" id="cb9-19" title="19">      .<span class="at">attr</span>(<span class="st">&quot;transform&quot;</span><span class="op">,</span> <span class="st">&quot;rotate(-90)&quot;</span>)</a>
<a class="sourceLine" id="cb9-20" title="20">      .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="dv">6</span>)</a>
<a class="sourceLine" id="cb9-21" title="21">      .<span class="at">attr</span>(<span class="st">&quot;dy&quot;</span><span class="op">,</span> <span class="st">&quot;0.71em&quot;</span>)</a>
<a class="sourceLine" id="cb9-22" title="22">      .<span class="at">attr</span>(<span class="st">&quot;text-anchor&quot;</span><span class="op">,</span> <span class="st">&quot;end&quot;</span>)</a>
<a class="sourceLine" id="cb9-23" title="23">      .<span class="at">text</span>(<span class="st">&quot;Frequency&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-24" title="24"></a>
<a class="sourceLine" id="cb9-25" title="25">  <span class="va">g</span>.<span class="at">selectAll</span>(<span class="st">&quot;.bar&quot;</span>)</a>
<a class="sourceLine" id="cb9-26" title="26">    .<span class="at">data</span>(data)</a>
<a class="sourceLine" id="cb9-27" title="27">    .<span class="at">enter</span>().<span class="at">append</span>(<span class="st">&quot;rect&quot;</span>)</a>
<a class="sourceLine" id="cb9-28" title="28">      .<span class="at">attr</span>(<span class="st">&quot;class&quot;</span><span class="op">,</span> <span class="st">&quot;bar&quot;</span>)</a>
<a class="sourceLine" id="cb9-29" title="29">      .<span class="at">attr</span>(<span class="st">&quot;x&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">x</span>(<span class="va">d</span>.<span class="at">letter</span>)<span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb9-30" title="30">      .<span class="at">attr</span>(<span class="st">&quot;y&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> <span class="at">y</span>(<span class="va">d</span>.<span class="at">frequency</span>)<span class="op">;</span> <span class="op">}</span>)</a>
<a class="sourceLine" id="cb9-31" title="31">      .<span class="at">attr</span>(<span class="st">&quot;width&quot;</span><span class="op">,</span> <span class="va">x</span>.<span class="at">bandwidth</span>())</a>
<a class="sourceLine" id="cb9-32" title="32">      .<span class="at">attr</span>(<span class="st">&quot;height&quot;</span><span class="op">,</span> <span class="kw">function</span>(d) <span class="op">{</span> <span class="cf">return</span> height <span class="op">-</span> <span class="at">y</span>(<span class="va">d</span>.<span class="at">frequency</span>)<span class="op">;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-33" title="33">})<span class="op">;</span></a></code></pre></div>
<p>DOM manipulation in D3 happens via D3 selections. They’re a lot like jQuery <code>$(something)</code>. This is the part we’re doing with React later on.</p>
<p>Here Bostock does a few things</p>
<ul>
<li>selects the <code>&lt;svg&gt;</code> node (<code>d3.select</code>)</li>
<li>appends a grouping <code>&lt;g&gt;</code> node (<code>.append</code>) with an SVG positioning attribute (translate)</li>
<li>adds a bottom axis by appending a <code>&lt;g&gt;</code>, moving it, then calling <code>d3.axisBottom</code> on it. D3 has built-in axis generators</li>
<li>adds a left axis using the same approach but rotating the ticks</li>
<li>appends a text label “Frequency” to the left axis</li>
<li>uses <code>selectAll.data</code> to make a virtual selection of <code>.bar</code> nodes and attach some data, then for every new data value (.enter), appends a <code>&lt;rect&gt;</code> node and gives it attributes</li>
</ul>
<p>That last part is where people get lost. It looks like magic. Even to me.</p>
<p>It’s a declarative approach to rendering data. Works great, hard to understand. That’s why we’ll do it in React instead :)</p>
<p>You can think of <code>.enter</code> as a loop over your data. Everything chained after <code>.enter</code> is your loop’s body. Sort of like doing <code>data.map(d =&gt; append(rect).setManyAttributes())</code></p>
<p>That function executes for any <em>new</em> data “entering” your visualization. There’s also <code>.exit</code> for anything that’s dropping out, and <code>.update</code> for anything that’s changing.</p>